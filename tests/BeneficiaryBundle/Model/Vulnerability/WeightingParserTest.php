<?php

namespace Tests\BeneficiaryBundle\Model\Vulnerability;

use BeneficiaryBundle\Exception\WeightingParserException;
use BeneficiaryBundle\Model\Vulnerability\WeightingParser;
use Symfony\Bundle\FrameworkBundle\Test\KernelTestCase;

class WeightingParserTest extends KernelTestCase
{
    private const RESOURCE_PATH = __DIR__.'/../../Resources/Vulnerability/';

    /** @var WeightingParser */
    private $weightingParser;


    public function setUp()
    {
        $this->weightingParser = new WeightingParser();
    }

    public function testCsvBadStructure()
    {
        $this->expectException(WeightingParserException::class);
        $this->expectExceptionMessage('CSV file has wrong structure');

        $this->weightingParser->parse(self::RESOURCE_PATH.'weighting_bad_structure');
    }

    public function testBadCountryFormat()
    {
        $this->expectException(WeightingParserException::class);
        $this->expectExceptionMessage('Bad country format');

        $this->weightingParser->parse(self::RESOURCE_PATH.'weighting_bad_country_format');
    }

    public function testUnknownSector()
    {
        $this->expectException(WeightingParserException::class);
        $this->expectExceptionMessage('Unknown structure');

        $this->weightingParser->parse(self::RESOURCE_PATH.'weighting_unknown_sector');
    }

    public function testIncompleteRow()
    {
        $this->expectException(WeightingParserException::class);
        $this->expectExceptionMessage('Missing values');

        $this->weightingParser->parse(self::RESOURCE_PATH.'weighting_row_incomplete');
    }
}
